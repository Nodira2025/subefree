<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen con Publicidad - Instituto NOA</title>
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fuente -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #ff6600;
            --primary-dark: #d35400;
            --secondary-color: #c0392b;
            --accent-color: #27ae60;
            --bg-color: #fff5e6;
            --text-color: #333;
            --card-bg: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--bg-color); color: var(--text-color); display: flex; justify-content: center; min-height: 100vh; padding: 20px; }

        .container { width: 100%; max-width: 800px; background: var(--card-bg); border-radius: 20px; box-shadow: 0 10px 30px rgba(255, 102, 0, 0.2); overflow: hidden; display: flex; flex-direction: column; position: relative; z-index: 1; }

        /* HEADER */
        header { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; }
        .logo-area { font-weight: 900; font-size: 1.3rem; display: flex; align-items: center; gap: 10px; text-transform: uppercase; }
        .timer-badge { background: white; color: var(--primary-color); padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 1.2rem; display: flex; align-items: center; gap: 5px; border: 2px solid #fff; }
        .btn-finish-early { background: #c0392b; color: white; border: none; padding: 8px 12px; border-radius: 5px; font-size: 0.8rem; cursor: pointer; margin-left: 10px; }
        .progress-container { background-color: #eee; height: 8px; width: 100%; }
        .progress-bar { background-color: var(--accent-color); height: 100%; width: 0%; transition: width 0.3s ease; }

        /* SCREENS */
        .screen { padding: 25px; flex: 1; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; animation: fadeIn 0.4s; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .intro-icon { font-size: 5rem; color: var(--primary-color); margin-bottom: 20px; }
        .btn { background-color: var(--primary-color); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: transform 0.2s; margin-top: 20px; text-decoration: none; display: inline-block; box-shadow: 0 4px 0 #bf360c; }
        .btn:hover { transform: translateY(-2px); background: var(--primary-dark); }
        .btn-whatsapp { background-color: #25D366; box-shadow: 0 4px 0 #1e994a; width: 100%; margin-top: 15px; }

        /* GAME UI */
        .stats-bar { display: flex; justify-content: space-between; width: 100%; margin-bottom: 15px; font-weight: bold; color: #7f8c8d; }
        .lifelines-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .lifeline-btn { background: white; border: 2px solid var(--primary-color); color: var(--primary-color); width: 55px; height: 55px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; font-size: 0.7rem; font-weight: bold; }
        .lifeline-btn:disabled { border-color: #ccc; color: #ccc; opacity: 0.5; cursor: not-allowed; }
        .badge-count { position: absolute; top: -5px; right: -5px; background: var(--secondary-color); color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; }
        .question-image { width: 100%; height: 140px; border-radius: 10px; margin-bottom: 15px; background-color: #fff3e0; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: #ffcc80; border: 2px dashed #ffb74d; }
        .question-text { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; color: #444; min-height: 50px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }
        .option-btn { background: white; border: 2px solid #ddd; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 1rem; text-align: left; position: relative; color: #555; font-weight: 500; }
        .option-btn:hover:not(:disabled) { border-color: var(--primary-color); background: #fff8f0; }
        .option-btn.correct { background: var(--accent-color); color: white; border-color: var(--accent-color); }
        .option-btn.incorrect { background: var(--secondary-color); color: white; border-color: var(--secondary-color); }
        .option-btn.hidden { opacity: 0; pointer-events: none; }

        /* OVERLAYS */
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 900; padding: 20px; color: white; text-align: center; backdrop-filter: blur(5px); }
        
        .motivation-card { background: white; color: #333; border-radius: 15px; max-width: 400px; overflow: hidden; box-shadow: 0 10px 30px rgba(255,255,255,0.2); animation: popIn 0.5s; }
        .motivation-img { width: 100%; height: 200px; object-fit: cover; }
        .motivation-content { padding: 20px; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* ESTILOS PARA PUBLICIDAD */
        .ad-card {
            background: white;
            width: 90%;
            max-width: 500px;
            padding: 20px;
            border-radius: 15px;
            position: relative;
            text-align: center;
            color: #333;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            animation: popIn 0.5s;
        }
        .ad-label {
            font-size: 0.7rem;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 10px;
            display: block;
            letter-spacing: 1px;
        }
        .ad-content-box {
            background: #f0f0f0;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            border: 1px dashed #ccc;
            overflow: hidden;
        }
        /* Clase para imagen publicitaria real */
        .ad-img-real { width: 100%; height: 100%; object-fit: contain; }
        
        .ad-btn-close {
            position: absolute;
            top: 10px; right: 10px;
            background: #ddd;
            border: none;
            width: 30px; height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            color: #555;
        }
        .ad-btn-action {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            display: inline-block;
            margin-top: 5px;
        }

        /* RESULT FORM */
        .student-form { width: 100%; background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: left; border: 1px solid #ddd; }
        .form-input { width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .review-list { width: 100%; text-align: left; max-height: 150px; overflow-y: auto; margin-top: 15px; border: 1px solid #ddd; padding: 10px; background: #fff; font-size: 0.8rem; }
        .alert-box { background: #ffebee; color: #c62828; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 0.9rem; border: 1px solid #ef9a9a; }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="container">
    <header>
        <div class="logo-area"><i class="fas fa-palette"></i> INSTITUTO NOA</div>
        <div style="display:flex; align-items:center;">
            <div class="timer-badge" id="timerBadge" style="display:none;">
                <i class="fas fa-stopwatch"></i> <span id="timer">20</span>
            </div>
            <button class="btn-finish-early" id="finishBtn" onclick="confirmFinish()" style="display:none;">
                <i class="fas fa-flag"></i> Fin
            </button>
        </div>
    </header>
    <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

    <!-- PANTALLA INICIO -->
    <div id="startScreen" class="screen active">
        <div class="intro-icon"><i class="fas fa-swatchbook"></i></div>
        <h1 style="color:var(--primary-color)">Examen: Teoría del Color</h1>
        <p style="margin:10px 0; color:#666">Basado en el video "Conceptos Básicos"</p>
        
        <ul style="font-size: 0.9rem; color: #666; margin: 20px 0; list-style: none; text-align: left; display: inline-block;">
            <li><i class="fas fa-check" style="color:var(--accent-color)"></i> 100 Consignas.</li>
            <li><i class="fas fa-clock" style="color:var(--accent-color)"></i> 20 segundos por pregunta.</li>
            <li><i class="fas fa-ad" style="color:var(--accent-color)"></i> Contiene anuncios patrocinados.</li>
        </ul>
        <br>
        <button class="btn" onclick="startQuiz()">COMENZAR EXAMEN</button>
    </div>

    <!-- PANTALLA JUEGO -->
    <div id="gameScreen" class="screen">
        <div class="stats-bar">
            <span id="qCount">1/100</span>
            <span id="sCount">Aciertos: 0</span>
        </div>
        <div class="lifelines-container">
            <button class="lifeline-btn" id="btnFifty" onclick="useFifty()"><div class="badge-count" id="c50">3</div><i class="fas fa-adjust"></i> 50:50</button>
            <button class="lifeline-btn" id="btnTime" onclick="useTime()"><div class="badge-count" id="cTime">4</div><i class="fas fa-clock"></i> +15s</button>
            <button class="lifeline-btn" id="btnSkip" onclick="useSkip()"><div class="badge-count" id="cSkip">1</div><i class="fas fa-gift"></i> Skip</button>
        </div>
        <div class="question-image" id="qImage"></div>
        <div class="question-text" id="qText"></div>
        <div class="options-grid" id="optContainer"></div>
    </div>

    <!-- OVERLAY FEEDBACK -->
    <div id="feedbackOverlay" class="overlay">
        <div id="fbIcon" style="font-size: 4rem; margin-bottom: 15px;"></div>
        <h2 id="fbTitle" style="margin-bottom: 10px;"></h2>
        <p id="fbText" style="margin-bottom: 25px; font-size: 1.1rem; line-height: 1.4;"></p>
        <button class="btn" id="nextBtn" style="background:white; color:var(--primary-color); box-shadow:none;">CONTINUAR <i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- OVERLAY MOTIVACIÓN (Cada 5 preguntas) -->
    <div id="motivationOverlay" class="overlay" style="background: rgba(0,0,0,0.85);">
        <div class="motivation-card">
            <img src="" id="motImg" class="motivation-img" alt="Motivación">
            <div class="motivation-content">
                <div class="motivation-quote" id="motQuote"></div>
                <p style="font-size: 0.9rem; color: #666;">¡Muy bien! Sigue avanzando.</p>
                <button class="btn" onclick="closeOverlay('motivationOverlay')" style="padding: 10px 30px; margin-top: 15px; font-size: 0.9rem;">CONTINUAR</button>
            </div>
        </div>
    </div>

    <!-- OVERLAY PUBLICIDAD (Al inicio y cada 10 preguntas) -->
    <div id="adOverlay" class="overlay" style="background: rgba(0,0,0,0.92); z-index: 9999;">
        <div class="ad-card">
            <span class="ad-label">Anuncio Patrocinado</span>
            <button class="ad-btn-close" onclick="closeOverlay('adOverlay')">X</button>
            
            <!-- AQUÍ IRÍA EL CÓDIGO DE GOOGLE ADSENSE SI TUVIERAS EL SCRIPT APROBADO -->
            <!-- 
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <ins class="adsbygoogle" ...></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            -->

            <!-- PUBLICIDAD PERSONALIZADA (FALLBACK) -->
            <div class="ad-content-box" id="adContent">
                <!-- La imagen se carga por JS -->
            </div>
            
            <h3 id="adTitle" style="margin-bottom:5px;">Visita Instituto NOA</h3>
            <p id="adDesc" style="font-size:0.9rem; margin-bottom:15px;">Líderes en formación profesional.</p>
            <a href="#" id="adLink" class="ad-btn-action" target="_blank">VER MÁS</a>
        </div>
    </div>

    <!-- RESULTADOS -->
    <div id="resultScreen" class="screen">
        <h2 style="color: #666;">Examen Finalizado</h2>
        <div class="alert-box" id="cheatAlert" style="display:none;">
            <i class="fas fa-user-lock"></i> Intento de reingreso bloqueado. Resultado anterior:
        </div>
        <div id="rankBadge" style="background:gray; color:white; padding:5px 15px; border-radius:15px; font-weight:bold; margin:10px 0;">NIVEL</div>
        <div class="result-score" id="finalScore">0/100</div>
        <p id="motivationalMsg">Mensaje</p>

        <div class="student-form">
            <h4 style="border-bottom:1px solid #ddd; padding-bottom:5px; margin-bottom:10px; color:var(--primary-color);">
                <i class="fas fa-paper-plane"></i> Enviar al Profesor
            </h4>
            <label>Nombre Completo:</label><input type="text" id="inputName" class="form-input" placeholder="Tu nombre">
            <label>DNI:</label><input type="number" id="inputDNI" class="form-input" placeholder="Tu DNI">
            <label>Curso / Comisión:</label><input type="text" id="inputCourse" class="form-input" placeholder="Ej: Diseño Gráfico">
            <div style="font-size: 0.8rem; color: #888; margin-top:5px;">Código: <span id="valCode" style="font-family:monospace; font-weight:bold;">---</span></div>
        </div>

        <a href="#" id="whatsappBtn" class="btn btn-whatsapp" onclick="return validateAndSend()">
            <i class="fab fa-whatsapp"></i> ENVIAR RESULTADO
        </a>
        <div class="review-list" id="reviewList"></div>
    </div>
</div>

<script>
    const TIME_PER_QUESTION = 20;
    const PASS_SCORE = 40;
    
    // --- CONFIGURACIÓN DE PUBLICIDAD ---
    // Cambia estos valores por la URL de tu página y la imagen que desees
    const adConfig = {
        url: "https://institutonoa.com.ar/", // Link de destino
        title: "¡Fórmate con los mejores!",
        desc: "Cursos presenciales y online con certificación.",
        // Usamos una imagen de placeholder, puedes poner la URL de tu banner
        image: "https://via.placeholder.com/400x300.png?text=Tu+Publicidad+Aqui+NOA" 
    };

    // --- BASE DE DATOS (100 Preguntas Video) ---
    const db = [
        { q: "¿Qué sistema usa el modelo RGB?", o: ["Aditivo", "Sustractivo", "Mixto", "Analógico"], a: 0, e: "RGB es luz (Aditivo).", i: "fa-lightbulb" },
        { q: "¿Qué colores son primarios en RGB?", o: ["Rojo, Verde, Azul", "Cian, Magenta, Amarillo", "Rojo, Amarillo, Azul", "Blanco, Negro"], a: 0, e: "Red, Green, Blue.", i: "fa-desktop" },
        { q: "El modelo CMYK se usa para...", o: ["Impresión", "Pantallas", "Proyección", "Web"], a: 0, e: "CMYK (tintas) es para impresión.", i: "fa-print" },
        { q: "¿Cómo se obtiene ROJO en CMYK?", o: ["Magenta + Amarillo", "Es primario", "Cian + Magenta", "Negro + Amarillo"], a: 0, e: "En CMYK el rojo es secundario.", i: "fa-palette" },
        { q: "Si mezclamos un color con su complementario, el color se...", o: ["Quiebra (oscurece)", "Aclara", "Satura", "Vuelve blanco"], a: 0, e: "Se obtienen tonos tierra o quebrados.", i: "fa-vial" },
        { q: "El complementario del Amarillo es el...", o: ["Morado", "Azul", "Rojo", "Verde"], a: 0, e: "Están opuestos en la rueda.", i: "fa-xmarks-lines" },
        { q: "¿Qué es el Tono?", o: ["El color en sí mismo", "La cantidad de luz", "La pureza", "La mezcla con gris"], a: 0, e: "Es la cualidad que define el color.", i: "fa-tag" },
        { q: "Aclarar un color con blanco hace que...", o: ["Pierda saturación", "Gane brillo y saturación", "Se vuelva negro", "No cambia"], a: 0, e: "Se vuelve tono pastel (pierde fuerza).", i: "fa-droplet" },
        { q: "Para aclarar sin perder saturación usamos...", o: ["Un color análogo más claro", "Blanco", "Negro", "Agua"], a: 0, e: "Ej: Aclarar rojo con amarillo.", i: "fa-wand-magic-sparkles" },
        { q: "¿Qué es el contraste simultáneo?", o: ["Percibir un color distinto según su fondo", "Ver dos colores iguales", "Mezclar rápido", "Usar RGB y CMYK"], a: 0, e: "Es una ilusión óptica de percepción.", i: "fa-eye" },
        { q: "La infrapintura sirve para...", o: ["Quitar el miedo al lienzo blanco", "Pintar con infrarrojos", "Ahorrar pintura", "Barnizar"], a: 0, e: "Da un tono base y evita el blanco puro.", i: "fa-brush" },
        { q: "El esquema de triadas forma un...", o: ["Triángulo equilátero", "Cuadrado", "Círculo", "Línea recta"], a: 0, e: "Son 3 colores equidistantes.", i: "fa-shapes" },
        { q: "El esquema monocromático usa...", o: ["Un solo color con variantes", "Blanco y negro", "Todos los colores", "Dos opuestos"], a: 0, e: "Mono = Uno.", i: "fa-layer-group" },
        { q: "¿Qué colores son análogos?", o: ["Los vecinos en la rueda", "Los opuestos", "Los primarios", "Los oscuros"], a: 0, e: "Están uno al lado del otro.", i: "fa-hand-holding-hand" },
        { q: "Oscurecer amarillo con negro produce...", o: ["Un tono verdoso sucio", "Amarillo oscuro puro", "Naranja", "Azul"], a: 0, e: "El negro ensucia la mezcla.", i: "fa-poo" }
    ];

    let questions = [];
    while(questions.length < 100) questions = questions.concat(db);
    questions = questions.slice(0, 100).sort(() => Math.random() - 0.5);

    const motivations = [
        { t: "¡Sigue así! El color es emoción.", i: "https://images.unsplash.com/photo-1500462918059-b1a0cb512f1d?auto=format&fit=crop&w=500&q=60" },
        { t: "Estás dominando la teoría.", i: "https://images.unsplash.com/photo-1541701494587-cb58502866ab?auto=format&fit=crop&w=500&q=60" },
        { t: "Cada respuesta correcta es un paso más.", i: "https://images.unsplash.com/photo-1596548438137-d51ea5c83ca5?auto=format&fit=crop&w=500&q=60" }
    ];
    
    // VARIABLES
    let currentIdx = 0;
    let score = 0;
    let userAns = [];
    let timerInterval;
    let timeLeft = TIME_PER_QUESTION;
    let startTime;
    let lifelines = { fifty: 3, time: 4, skip: 1 };
    
    // DOM
    const timerDisplay = document.getElementById('timer');
    const startScreen = document.getElementById('startScreen');
    const gameScreen = document.getElementById('gameScreen');
    const resultScreen = document.getElementById('resultScreen');

    // --- FUNCIONES DE PUBLICIDAD ---
    
    function showAd() {
        const adOverlay = document.getElementById('adOverlay');
        
        // Configurar contenido del anuncio
        document.getElementById('adLink').href = adConfig.url;
        document.getElementById('adTitle').innerText = adConfig.title;
        document.getElementById('adDesc').innerText = adConfig.desc;
        document.getElementById('adContent').innerHTML = `<img src="${adConfig.image}" class="ad-img-real" alt="Publicidad">`;

        adOverlay.style.display = 'flex';
        
        // Si estamos en juego, pausar timer
        if(gameScreen.classList.contains('active')) {
            clearInterval(timerInterval);
        }
    }

    function closeOverlay(id) {
        document.getElementById(id).style.display = 'none';
        
        // Si es publicidad o motivación dentro del juego, pasar a siguiente
        if(gameScreen.classList.contains('active')) {
            if(id === 'adOverlay' && currentIdx > 0) { // Si no es el anuncio de inicio
                nextQ(); 
            } else if(id === 'motivationOverlay') {
                nextQ();
            } else if(id === 'adOverlay' && currentIdx === 0) {
                // Anuncio inicial cerrado, no hacemos nada especial, el usuario dará a "Comenzar" o ya le dio
            }
        }
    }

    // --- LÓGICA DEL JUEGO ---

    window.onload = function() {
        // 1. Mostrar Publicidad al cargar (Requisito)
        setTimeout(showAd, 500);

        // 2. Chequear si ya rindió
        if(localStorage.getItem('noa_exam_ads_res')) {
            const data = JSON.parse(localStorage.getItem('noa_exam_ads_res'));
            // Si ya rindió, ocultamos el start y vamos a resultados (el anuncio se verá sobre resultados)
            showResults(data.score, data.userAns, true);
        }
    };

    function startQuiz() {
        startScreen.classList.remove('active');
        gameScreen.classList.add('active');
        document.getElementById('timerBadge').style.display = 'flex';
        document.getElementById('finishBtn').style.display = 'block';
        startTime = new Date();
        loadQuestion();
    }

    function loadQuestion() {
        const q = questions[currentIdx];
        document.getElementById('qCount').innerText = `${currentIdx + 1}/100`;
        document.getElementById('sCount').innerText = `Aciertos: ${score}`;
        document.getElementById('progressBar').style.width = `${(currentIdx/100)*100}%`;
        document.getElementById('qText').innerText = q.q;
        document.getElementById('qImage').innerHTML = `<i class="fas ${q.i}"></i>`;
        
        const cont = document.getElementById('optContainer');
        cont.innerHTML = '';
        q.o.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => answer(i, btn);
            cont.appendChild(btn);
        });

        updateLifelines();
        resetTimer();
    }

    function resetTimer() {
        clearInterval(timerInterval);
        timeLeft = TIME_PER_QUESTION;
        timerDisplay.innerText = timeLeft;
        timerDisplay.parentElement.style.background = 'white';
        timerDisplay.parentElement.style.color = 'var(--primary-color)';

        timerInterval = setInterval(() => {
            timeLeft--;
            timerDisplay.innerText = timeLeft;
            if(timeLeft <= 5) {
                timerDisplay.parentElement.style.background = '#c0392b';
                timerDisplay.parentElement.style.color = 'white';
            }
            if(timeLeft <= 0) {
                clearInterval(timerInterval);
                timeOver();
            }
        }, 1000);
    }

    function timeOver() {
        const q = questions[currentIdx];
        recordAnswer(q.q, "Tiempo Agotado", q.o[q.a], false);
        feedback(false, "¡Tiempo Agotado!", q.e, "fa-hourglass-end");
    }

    function answer(idx, btn) {
        clearInterval(timerInterval);
        const q = questions[currentIdx];
        const isCorrect = (idx === q.a);
        
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.disabled = true);

        if(isCorrect) { btn.classList.add('correct'); score++; }
        else { btn.classList.add('incorrect'); btns[q.a].classList.add('correct'); }

        recordAnswer(q.q, q.o[idx], q.o[q.a], isCorrect);
        feedback(isCorrect, isCorrect ? "¡Correcto!" : "Incorrecto", q.e, isCorrect ? "fa-check" : "fa-times");
    }

    function recordAnswer(q, u, c, ok) { userAns.push({q, u, c, ok}); }

    function feedback(ok, title, exp, icon) {
        const overlay = document.getElementById('feedbackOverlay');
        document.getElementById('fbTitle').innerText = title;
        document.getElementById('fbTitle').style.color = ok ? '#2ecc71' : '#e74c3c';
        document.getElementById('fbIcon').innerHTML = `<i class="fas ${icon}" style="color:${ok ? '#2ecc71' : '#e74c3c'}"></i>`;
        document.getElementById('fbText').innerHTML = `<strong>Explicación:</strong> ${exp}`;
        
        overlay.style.display = 'flex';
        document.getElementById('nextBtn').onclick = () => {
            overlay.style.display = 'none';
            checkIntersticial(); // Chequear si toca publicidad o motivación
        };
    }

    function checkIntersticial() {
        const nextIndex = currentIdx + 1;
        
        // Lógica de prioridades:
        // 1. Cada 10 preguntas -> PUBLICIDAD
        if (currentIdx > 0 && nextIndex % 10 === 0 && currentIdx < 99) {
            showAd();
        }
        // 2. Cada 5 preguntas (que no sean múltiplo de 10) -> MOTIVACIÓN
        else if (currentIdx > 0 && nextIndex % 5 === 0 && currentIdx < 99) {
            showMotivation();
        }
        // 3. Sino, siguiente pregunta
        else {
            nextQ();
        }
    }

    function showMotivation() {
        const overlay = document.getElementById('motivationOverlay');
        const randomMot = motivations[Math.floor(Math.random() * motivations.length)];
        document.getElementById('motImg').src = randomMot.i;
        document.getElementById('motQuote').innerText = `"${randomMot.t}"`;
        overlay.style.display = 'flex';
    }

    function nextQ() {
        currentIdx++;
        if(currentIdx < 100) loadQuestion();
        else finish();
    }

    // COMODINES
    function updateLifelines() {
        document.getElementById('c50').innerText = lifelines.fifty;
        document.getElementById('cTime').innerText = lifelines.time;
        document.getElementById('cSkip').innerText = lifelines.skip;
        document.getElementById('btnFifty').disabled = lifelines.fifty <= 0;
        document.getElementById('btnTime').disabled = lifelines.time <= 0;
        document.getElementById('btnSkip').disabled = lifelines.skip <= 0;
    }
    function useFifty() { if(lifelines.fifty > 0) {
        const q = questions[currentIdx];
        const btns = Array.from(document.querySelectorAll('.option-btn'));
        let wrongs = btns.map((_, i) => i).filter(i => i !== q.a);
        wrongs.sort(() => Math.random() - 0.5).slice(0, 2).forEach(i => btns[i].classList.add('hidden'));
        lifelines.fifty--; updateLifelines();
    }}
    function useTime() { if(lifelines.time > 0) { timeLeft += 15; timerDisplay.innerText = timeLeft; lifelines.time--; updateLifelines(); }}
    function useSkip() { if(lifelines.skip > 0) { clearInterval(timerInterval); score++; recordAnswer(questions[currentIdx].q, "COMODÍN", "---", true); lifelines.skip--; updateLifelines(); feedback(true, "¡Regalada!", "Comodín usado.", "fa-gift"); }}

    function confirmFinish() { if(confirm("¿Terminar ahora?")) { clearInterval(timerInterval); finish(); }}

    function finish() {
        const examData = { score: score, userAns: userAns, date: new Date().toISOString() };
        localStorage.setItem('noa_exam_ads_res', JSON.stringify(examData));
        showResults(score, userAns, false);
    }

    function showResults(finalScore, answers, isRevisit) {
        startScreen.classList.remove('active');
        gameScreen.classList.remove('active');
        resultScreen.classList.add('active');
        document.getElementById('timerBadge').style.display = 'none';
        document.getElementById('finishBtn').style.display = 'none';

        if(isRevisit) {
            document.getElementById('cheatAlert').style.display = 'block';
            document.getElementById('whatsappBtn').innerText = "REENVIAR RESULTADO";
        }

        document.getElementById('finalScore').innerText = `${finalScore}/100`;
        const rankEl = document.getElementById('rankBadge');
        if(finalScore >= 90) { rankEl.innerText = "EXPERTO"; rankEl.style.background = "#27ae60"; }
        else if(finalScore >= PASS_SCORE) { rankEl.innerText = "APROBADO"; rankEl.style.background = "#f39c12"; }
        else { rankEl.innerText = "REPROBADO"; rankEl.style.background = "#c0392b"; }
        document.getElementById('motivationalMsg').innerText = finalScore >= PASS_SCORE ? "¡Buen trabajo!" : "Inténtalo de nuevo.";

        const code = `NOA-${finalScore}-${Math.floor(Math.random()*9000)+1000}`;
        document.getElementById('valCode').innerText = code;

        const list = document.getElementById('reviewList');
        list.innerHTML = '';
        answers.forEach((a, i) => {
            const div = document.createElement('div');
            div.style.borderBottom = "1px solid #eee"; div.style.padding = "5px"; div.style.color = a.ok ? "green" : "red";
            div.innerHTML = `<strong>${i+1}.</strong> ${a.ok ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'} ${a.q}`;
            list.appendChild(div);
        });
    }

    function validateAndSend() {
        const name = document.getElementById('inputName').value.trim();
        const dni = document.getElementById('inputDNI').value.trim();
        const course = document.getElementById('inputCourse').value.trim();
        const code = document.getElementById('valCode').innerText;
        if(!name || !dni || !course) { alert("Completa los datos."); return false; }
        
        const msg = `*EXAMEN COLOR (ADS) - NOA*%0A--------------------------%0A*Alumno:* ${name}%0A*DNI:* ${dni}%0A*Curso:* ${course}%0A*Nota:* ${score}/100%0A*Código:* ${code}%0A--------------------------`;
        window.open(`https://wa.me/5493812234142?text=${msg}`, '_blank');
    }
</script>
</body>
</html>
Model
ThinkingThoughts
Expand to view model thoughts

chevron_right
¡Perfecto! He integrado el código de Adsterra en el sistema.
¿Cómo funciona ahora la publicidad?
Integración Dinámica: He creado una función que "inyecta" el script de Adsterra dentro de la ventana del anuncio cada vez que esta aparece.
Momentos de aparición:
Al cargar: Apenas abres la web, sale la ventana con el anuncio cargando.
Cada 10 preguntas: Se pausa el examen y se recarga el script para intentar mostrar un nuevo anuncio (impresión nueva).
Importante: Dependiendo de la configuración que tengas en tu cuenta de Adsterra (si es Banner, Social Bar, Popunder, etc.), el comportamiento visual puede variar. El código está colocado dentro del contenedor visual del aviso.
Guarda este archivo como examen_video_adsterra.html.
code
Html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen: Teoría del Color - Instituto NOA</title>
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fuente -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #ff6600;
            --primary-dark: #d35400;
            --secondary-color: #c0392b;
            --accent-color: #27ae60;
            --bg-color: #fff5e6;
            --text-color: #333;
            --card-bg: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--bg-color); color: var(--text-color); display: flex; justify-content: center; min-height: 100vh; padding: 20px; }

        .container { width: 100%; max-width: 800px; background: var(--card-bg); border-radius: 20px; box-shadow: 0 10px 30px rgba(255, 102, 0, 0.2); overflow: hidden; display: flex; flex-direction: column; position: relative; z-index: 1; }

        /* HEADER */
        header { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; }
        .logo-area { font-weight: 900; font-size: 1.3rem; display: flex; align-items: center; gap: 10px; text-transform: uppercase; }
        .timer-badge { background: white; color: var(--primary-color); padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 1.2rem; display: flex; align-items: center; gap: 5px; border: 2px solid #fff; }
        .btn-finish-early { background: #c0392b; color: white; border: none; padding: 8px 12px; border-radius: 5px; font-size: 0.8rem; cursor: pointer; margin-left: 10px; }
        .progress-container { background-color: #eee; height: 8px; width: 100%; }
        .progress-bar { background-color: var(--accent-color); height: 100%; width: 0%; transition: width 0.3s ease; }

        /* SCREENS */
        .screen { padding: 25px; flex: 1; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; animation: fadeIn 0.4s; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .intro-icon { font-size: 5rem; color: var(--primary-color); margin-bottom: 20px; }
        .btn { background-color: var(--primary-color); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: transform 0.2s; margin-top: 20px; text-decoration: none; display: inline-block; box-shadow: 0 4px 0 #bf360c; }
        .btn:hover { transform: translateY(-2px); background: var(--primary-dark); }
        .btn-whatsapp { background-color: #25D366; box-shadow: 0 4px 0 #1e994a; width: 100%; margin-top: 15px; }

        /* GAME UI */
        .stats-bar { display: flex; justify-content: space-between; width: 100%; margin-bottom: 15px; font-weight: bold; color: #7f8c8d; }
        .lifelines-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .lifeline-btn { background: white; border: 2px solid var(--primary-color); color: var(--primary-color); width: 55px; height: 55px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; font-size: 0.7rem; font-weight: bold; }
        .lifeline-btn:disabled { border-color: #ccc; color: #ccc; opacity: 0.5; cursor: not-allowed; }
        .badge-count { position: absolute; top: -5px; right: -5px; background: var(--secondary-color); color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; }
        .question-image { width: 100%; height: 140px; border-radius: 10px; margin-bottom: 15px; background-color: #fff3e0; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: #ffcc80; border: 2px dashed #ffb74d; }
        .question-text { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; color: #444; min-height: 50px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }
        .option-btn { background: white; border: 2px solid #ddd; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 1rem; text-align: left; position: relative; color: #555; font-weight: 500; }
        .option-btn:hover:not(:disabled) { border-color: var(--primary-color); background: #fff8f0; }
        .option-btn.correct { background: var(--accent-color); color: white; border-color: var(--accent-color); }
        .option-btn.incorrect { background: var(--secondary-color); color: white; border-color: var(--secondary-color); }
        .option-btn.hidden { opacity: 0; pointer-events: none; }

        /* OVERLAYS */
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 900; padding: 20px; color: white; text-align: center; backdrop-filter: blur(5px); }
        
        .motivation-card { background: white; color: #333; border-radius: 15px; max-width: 400px; overflow: hidden; box-shadow: 0 10px 30px rgba(255,255,255,0.2); animation: popIn 0.5s; }
        .motivation-img { width: 100%; height: 200px; object-fit: cover; }
        .motivation-content { padding: 20px; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* ESTILOS PARA PUBLICIDAD ADSTERRA */
        .ad-card {
            background: white;
            width: 95%;
            max-width: 600px;
            padding: 10px;
            border-radius: 15px;
            position: relative;
            text-align: center;
            color: #333;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            animation: popIn 0.5s;
            overflow: hidden;
        }
        
        .ad-content-box {
            background: #f9f9f9;
            min-height: 250px; /* Altura mínima para que quepa el anuncio */
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            border: 1px solid #eee;
            position: relative;
        }
        
        .ad-label {
            font-size: 0.7rem;
            color: #ccc;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 5px;
            display: block;
        }

        .ad-btn-close {
            position: absolute;
            top: 5px; right: 5px;
            background: #333;
            border: none;
            width: 30px; height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            color: white;
            z-index: 10;
        }
        
        .ad-btn-continue {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        /* RESULT FORM */
        .student-form { width: 100%; background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: left; border: 1px solid #ddd; }
        .form-input { width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .review-list { width: 100%; text-align: left; max-height: 150px; overflow-y: auto; margin-top: 15px; border: 1px solid #ddd; padding: 10px; background: #fff; font-size: 0.8rem; }
        .alert-box { background: #ffebee; color: #c62828; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 0.9rem; border: 1px solid #ef9a9a; }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="container">
    <header>
        <div class="logo-area"><i class="fas fa-palette"></i> INSTITUTO NOA</div>
        <div style="display:flex; align-items:center;">
            <div class="timer-badge" id="timerBadge" style="display:none;">
                <i class="fas fa-stopwatch"></i> <span id="timer">20</span>
            </div>
            <button class="btn-finish-early" id="finishBtn" onclick="confirmFinish()" style="display:none;">
                <i class="fas fa-flag"></i> Fin
            </button>
        </div>
    </header>
    <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

    <!-- PANTALLA INICIO -->
    <div id="startScreen" class="screen active">
        <div class="intro-icon"><i class="fas fa-swatchbook"></i></div>
        <h1 style="color:var(--primary-color)">Examen: Teoría del Color</h1>
        <p style="margin:10px 0; color:#666">Basado en el video "Conceptos Básicos"</p>
        
        <ul style="font-size: 0.9rem; color: #666; margin: 20px 0; list-style: none; text-align: left; display: inline-block;">
            <li><i class="fas fa-check" style="color:var(--accent-color)"></i> 100 Consignas.</li>
            <li><i class="fas fa-clock" style="color:var(--accent-color)"></i> 20 segundos por pregunta.</li>
            <li><i class="fas fa-ad" style="color:var(--accent-color)"></i> Contiene anuncios.</li>
        </ul>
        <br>
        <button class="btn" onclick="startQuiz()">COMENZAR EXAMEN</button>
    </div>

    <!-- PANTALLA JUEGO -->
    <div id="gameScreen" class="screen">
        <div class="stats-bar">
            <span id="qCount">1/100</span>
            <span id="sCount">Aciertos: 0</span>
        </div>
        <div class="lifelines-container">
            <button class="lifeline-btn" id="btnFifty" onclick="useFifty()"><div class="badge-count" id="c50">3</div><i class="fas fa-adjust"></i> 50:50</button>
            <button class="lifeline-btn" id="btnTime" onclick="useTime()"><div class="badge-count" id="cTime">4</div><i class="fas fa-clock"></i> +15s</button>
            <button class="lifeline-btn" id="btnSkip" onclick="useSkip()"><div class="badge-count" id="cSkip">1</div><i class="fas fa-gift"></i> Skip</button>
        </div>
        <div class="question-image" id="qImage"></div>
        <div class="question-text" id="qText"></div>
        <div class="options-grid" id="optContainer"></div>
    </div>

    <!-- OVERLAY FEEDBACK -->
    <div id="feedbackOverlay" class="overlay">
        <div id="fbIcon" style="font-size: 4rem; margin-bottom: 15px;"></div>
        <h2 id="fbTitle" style="margin-bottom: 10px;"></h2>
        <p id="fbText" style="margin-bottom: 25px; font-size: 1.1rem; line-height: 1.4;"></p>
        <button class="btn" id="nextBtn" style="background:white; color:var(--primary-color); box-shadow:none;">CONTINUAR <i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- OVERLAY MOTIVACIÓN -->
    <div id="motivationOverlay" class="overlay" style="background: rgba(0,0,0,0.85);">
        <div class="motivation-card">
            <img src="" id="motImg" class="motivation-img" alt="Motivación">
            <div class="motivation-content">
                <div class="motivation-quote" id="motQuote"></div>
                <p style="font-size: 0.9rem; color: #666;">¡Muy bien! Sigue avanzando.</p>
                <button class="btn" onclick="closeOverlay('motivationOverlay')" style="padding: 10px 30px; margin-top: 15px; font-size: 0.9rem;">CONTINUAR</button>
            </div>
        </div>
    </div>

    <!-- OVERLAY PUBLICIDAD ADSTERRA -->
    <div id="adOverlay" class="overlay" style="background: rgba(0,0,0,0.95); z-index: 9999;">
        <div class="ad-card">
            <span class="ad-label">Publicidad</span>
            <button class="ad-btn-close" onclick="closeOverlay('adOverlay')">X</button>
            
            <!-- CONTENEDOR DONDE SE INYECTARÁ EL SCRIPT -->
            <div class="ad-content-box" id="adContainer">
                <p style="color:#aaa; font-size:0.8rem;">Cargando anuncio...</p>
            </div>
            
            <button class="ad-btn-continue" onclick="closeOverlay('adOverlay')">Cerrar y Continuar</button>
        </div>
    </div>

    <!-- RESULTADOS -->
    <div id="resultScreen" class="screen">
        <h2 style="color: #666;">Examen Finalizado</h2>
        <div class="alert-box" id="cheatAlert" style="display:none;">
            <i class="fas fa-user-lock"></i> Intento de reingreso bloqueado. Resultado anterior:
        </div>
        <div id="rankBadge" style="background:gray; color:white; padding:5px 15px; border-radius:15px; font-weight:bold; margin:10px 0;">NIVEL</div>
        <div class="result-score" id="finalScore">0/100</div>
        <p id="motivationalMsg">Mensaje</p>

        <div class="student-form">
            <h4 style="border-bottom:1px solid #ddd; padding-bottom:5px; margin-bottom:10px; color:var(--primary-color);">
                <i class="fas fa-paper-plane"></i> Enviar al Profesor
            </h4>
            <label>Nombre Completo:</label><input type="text" id="inputName" class="form-input" placeholder="Tu nombre">
            <label>DNI:</label><input type="number" id="inputDNI" class="form-input" placeholder="Tu DNI">
            <label>Curso / Comisión:</label><input type="text" id="inputCourse" class="form-input" placeholder="Ej: Diseño Gráfico">
            <div style="font-size: 0.8rem; color: #888; margin-top:5px;">Código: <span id="valCode" style="font-family:monospace; font-weight:bold;">---</span></div>
        </div>

        <a href="#" id="whatsappBtn" class="btn btn-whatsapp" onclick="return validateAndSend()">
            <i class="fab fa-whatsapp"></i> ENVIAR RESULTADO
        </a>
        <div class="review-list" id="reviewList"></div>
    </div>
</div>

<script>
    const TIME_PER_QUESTION = 20;
    const PASS_SCORE = 40;
    
    // --- LÓGICA DE PREGUNTAS ---
    const db = [
        { q: "¿Qué sistema usa el modelo RGB?", o: ["Aditivo", "Sustractivo", "Mixto", "Analógico"], a: 0, e: "RGB es luz (Aditivo).", i: "fa-lightbulb" },
        { q: "¿Qué colores son primarios en RGB?", o: ["Rojo, Verde, Azul", "Cian, Magenta, Amarillo", "Rojo, Amarillo, Azul", "Blanco, Negro"], a: 0, e: "Red, Green, Blue.", i: "fa-desktop" },
        { q: "El modelo CMYK se usa para...", o: ["Impresión", "Pantallas", "Proyección", "Web"], a: 0, e: "CMYK (tintas) es para impresión.", i: "fa-print" },
        { q: "¿Cómo se obtiene ROJO en CMYK?", o: ["Magenta + Amarillo", "Es primario", "Cian + Magenta", "Negro + Amarillo"], a: 0, e: "En CMYK el rojo es secundario.", i: "fa-palette" },
        { q: "Si mezclamos un color con su complementario, el color se...", o: ["Quiebra (oscurece)", "Aclara", "Satura", "Vuelve blanco"], a: 0, e: "Se obtienen tonos tierra o quebrados.", i: "fa-vial" },
        { q: "El complementario del Amarillo es el...", o: ["Morado", "Azul", "Rojo", "Verde"], a: 0, e: "Están opuestos en la rueda.", i: "fa-xmarks-lines" },
        { q: "¿Qué es el Tono?", o: ["El color en sí mismo", "La cantidad de luz", "La pureza", "La mezcla con gris"], a: 0, e: "Es la cualidad que define el color.", i: "fa-tag" },
        { q: "Aclarar un color con blanco hace que...", o: ["Pierda saturación", "Gane brillo y saturación", "Se vuelva negro", "No cambia"], a: 0, e: "Se vuelve tono pastel (pierde fuerza).", i: "fa-droplet" },
        { q: "Para aclarar sin perder saturación usamos...", o: ["Un color análogo más claro", "Blanco", "Negro", "Agua"], a: 0, e: "Ej: Aclarar rojo con amarillo.", i: "fa-wand-magic-sparkles" },
        { q: "¿Qué es el contraste simultáneo?", o: ["Percibir un color distinto según su fondo", "Ver dos colores iguales", "Mezclar rápido", "Usar RGB y CMYK"], a: 0, e: "Es una ilusión óptica de percepción.", i: "fa-eye" },
        { q: "La infrapintura sirve para...", o: ["Quitar el miedo al lienzo blanco", "Pintar con infrarrojos", "Ahorrar pintura", "Barnizar"], a: 0, e: "Da un tono base y evita el blanco puro.", i: "fa-brush" },
        { q: "El esquema de triadas forma un...", o: ["Triángulo equilátero", "Cuadrado", "Círculo", "Línea recta"], a: 0, e: "Son 3 colores equidistantes.", i: "fa-shapes" },
        { q: "El esquema monocromático usa...", o: ["Un solo color con variantes", "Blanco y negro", "Todos los colores", "Dos opuestos"], a: 0, e: "Mono = Uno.", i: "fa-layer-group" },
        { q: "¿Qué colores son análogos?", o: ["Los vecinos en la rueda", "Los opuestos", "Los primarios", "Los oscuros"], a: 0, e: "Están uno al lado del otro.", i: "fa-hand-holding-hand" },
        { q: "Oscurecer amarillo con negro produce...", o: ["Un tono verdoso sucio", "Amarillo oscuro puro", "Naranja", "Azul"], a: 0, e: "El negro ensucia la mezcla.", i: "fa-poo" }
    ];

    let questions = [];
    while(questions.length < 100) questions = questions.concat(db);
    questions = questions.slice(0, 100).sort(() => Math.random() - 0.5);

    const motivations = [
        { t: "¡Sigue así! El color es emoción.", i: "https://images.unsplash.com/photo-1500462918059-b1a0cb512f1d?auto=format&fit=crop&w=500&q=60" },
        { t: "Estás dominando la teoría.", i: "https://images.unsplash.com/photo-1541701494587-cb58502866ab?auto=format&fit=crop&w=500&q=60" },
        { t: "Cada respuesta correcta es un paso más.", i: "https://images.unsplash.com/photo-1596548438137-d51ea5c83ca5?auto=format&fit=crop&w=500&q=60" }
    ];
    
    // VARIABLES
    let currentIdx = 0;
    let score = 0;
    let userAns = [];
    let timerInterval;
    let timeLeft = TIME_PER_QUESTION;
    let startTime;
    let lifelines = { fifty: 3, time: 4, skip: 1 };
    
    // DOM
    const timerDisplay = document.getElementById('timer');
    const startScreen = document.getElementById('startScreen');
    const gameScreen = document.getElementById('gameScreen');
    const resultScreen = document.getElementById('resultScreen');

    // --- FUNCIONES DE PUBLICIDAD ADSTERRA ---
    
    function injectAdsterra() {
        const container = document.getElementById('adContainer');
        // Limpiamos contenido anterior
        container.innerHTML = '';
        
        // Creamos el script dinámicamente
        const script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = '//pl28146632.effectivegatecpm.com/d5/cf/80/d5cf80419b2247d347a2d1cc39aa75a3.js';
        
        // Lo añadimos al contenedor
        container.appendChild(script);
        
        // Texto de respaldo por si el adblock lo bloquea o tarda
        const fallbackText = document.createElement('p');
        fallbackText.style.color = '#ccc';
        fallbackText.style.fontSize = '0.7rem';
        fallbackText.style.marginTop = '10px';
        fallbackText.innerText = 'Patrocinado';
        container.appendChild(fallbackText);
    }

    function showAd() {
        const adOverlay = document.getElementById('adOverlay');
        adOverlay.style.display = 'flex';
        
        // Inyectar el anuncio
        injectAdsterra();
        
        // Si estamos en juego, pausar timer
        if(gameScreen.classList.contains('active')) {
            clearInterval(timerInterval);
        }
    }

    function closeOverlay(id) {
        document.getElementById(id).style.display = 'none';
        
        // Si es publicidad o motivación dentro del juego, pasar a siguiente
        if(gameScreen.classList.contains('active')) {
            if(id === 'adOverlay' && currentIdx > 0) { 
                nextQ(); 
            } else if(id === 'motivationOverlay') {
                nextQ();
            }
        }
    }

    // --- LÓGICA DEL JUEGO ---

    window.onload = function() {
        // 1. Mostrar Publicidad al cargar
        setTimeout(showAd, 800);

        // 2. Chequear si ya rindió
        if(localStorage.getItem('noa_exam_adsterra_res')) {
            const data = JSON.parse(localStorage.getItem('noa_exam_adsterra_res'));
            showResults(data.score, data.userAns, true);
        }
    };

    function startQuiz() {
        startScreen.classList.remove('active');
        gameScreen.classList.add('active');
        document.getElementById('timerBadge').style.display = 'flex';
        document.getElementById('finishBtn').style.display = 'block';
        startTime = new Date();
        loadQuestion();
    }

    function loadQuestion() {
        const q = questions[currentIdx];
        document.getElementById('qCount').innerText = `${currentIdx + 1}/100`;
        document.getElementById('sCount').innerText = `Aciertos: ${score}`;
        document.getElementById('progressBar').style.width = `${(currentIdx/100)*100}%`;
        document.getElementById('qText').innerText = q.q;
        document.getElementById('qImage').innerHTML = `<i class="fas ${q.i}"></i>`;
        
        const cont = document.getElementById('optContainer');
        cont.innerHTML = '';
        q.o.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => answer(i, btn);
            cont.appendChild(btn);
        });

        updateLifelines();
        resetTimer();
    }

    function resetTimer() {
        clearInterval(timerInterval);
        timeLeft = TIME_PER_QUESTION;
        timerDisplay.innerText = timeLeft;
        timerDisplay.parentElement.style.background = 'white';
        timerDisplay.parentElement.style.color = 'var(--primary-color)';

        timerInterval = setInterval(() => {
            timeLeft--;
            timerDisplay.innerText = timeLeft;
            if(timeLeft <= 5) {
                timerDisplay.parentElement.style.background = '#c0392b';
                timerDisplay.parentElement.style.color = 'white';
            }
            if(timeLeft <= 0) {
                clearInterval(timerInterval);
                timeOver();
            }
        }, 1000);
    }

    function timeOver() {
        const q = questions[currentIdx];
        recordAnswer(q.q, "Tiempo Agotado", q.o[q.a], false);
        feedback(false, "¡Tiempo Agotado!", q.e, "fa-hourglass-end");
    }

    function answer(idx, btn) {
        clearInterval(timerInterval);
        const q = questions[currentIdx];
        const isCorrect = (idx === q.a);
        
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.disabled = true);

        if(isCorrect) { btn.classList.add('correct'); score++; }
        else { btn.classList.add('incorrect'); btns[q.a].classList.add('correct'); }

        recordAnswer(q.q, q.o[idx], q.o[q.a], isCorrect);
        feedback(isCorrect, isCorrect ? "¡Correcto!" : "Incorrecto", q.e, isCorrect ? "fa-check" : "fa-times");
    }

    function recordAnswer(q, u, c, ok) { userAns.push({q, u, c, ok}); }

    function feedback(ok, title, exp, icon) {
        const overlay = document.getElementById('feedbackOverlay');
        document.getElementById('fbTitle').innerText = title;
        document.getElementById('fbTitle').style.color = ok ? '#2ecc71' : '#e74c3c';
        document.getElementById('fbIcon').innerHTML = `<i class="fas ${icon}" style="color:${ok ? '#2ecc71' : '#e74c3c'}"></i>`;
        document.getElementById('fbText').innerHTML = `<strong>Explicación:</strong> ${exp}`;
        
        overlay.style.display = 'flex';
        document.getElementById('nextBtn').onclick = () => {
            overlay.style.display = 'none';
            checkIntersticial(); 
        };
    }

    function checkIntersticial() {
        const nextIndex = currentIdx + 1;
        
        // 1. Cada 10 preguntas -> PUBLICIDAD ADSTERRA
        if (currentIdx > 0 && nextIndex % 10 === 0 && currentIdx < 99) {
            showAd();
        }
        // 2. Cada 5 preguntas -> MOTIVACIÓN
        else if (currentIdx > 0 && nextIndex % 5 === 0 && currentIdx < 99) {
            showMotivation();
        }
        else {
            nextQ();
        }
    }

    function showMotivation() {
        const overlay = document.getElementById('motivationOverlay');
        const randomMot = motivations[Math.floor(Math.random() * motivations.length)];
        document.getElementById('motImg').src = randomMot.i;
        document.getElementById('motQuote').innerText = `"${randomMot.t}"`;
        overlay.style.display = 'flex';
    }

    function nextQ() {
        currentIdx++;
        if(currentIdx < 100) loadQuestion();
        else finish();
    }

    function updateLifelines() {
        document.getElementById('c50').innerText = lifelines.fifty;
        document.getElementById('cTime').innerText = lifelines.time;
        document.getElementById('cSkip').innerText = lifelines.skip;
        document.getElementById('btnFifty').disabled = lifelines.fifty <= 0;
        document.getElementById('btnTime').disabled = lifelines.time <= 0;
        document.getElementById('btnSkip').disabled = lifelines.skip <= 0;
    }
    function useFifty() { if(lifelines.fifty > 0) {
        const q = questions[currentIdx];
        const btns = Array.from(document.querySelectorAll('.option-btn'));
        let wrongs = btns.map((_, i) => i).filter(i => i !== q.a);
        wrongs.sort(() => Math.random() - 0.5).slice(0, 2).forEach(i => btns[i].classList.add('hidden'));
        lifelines.fifty--; updateLifelines();
    }}
    function useTime() { if(lifelines.time > 0) { timeLeft += 15; timerDisplay.innerText = timeLeft; lifelines.time--; updateLifelines(); }}
    function useSkip() { if(lifelines.skip > 0) { clearInterval(timerInterval); score++; recordAnswer(questions[currentIdx].q, "COMODÍN", "---", true); lifelines.skip--; updateLifelines(); feedback(true, "¡Regalada!", "Comodín usado.", "fa-gift"); }}

    function confirmFinish() { if(confirm("¿Terminar ahora?")) { clearInterval(timerInterval); finish(); }}

    function finish() {
        const examData = { score: score, userAns: userAns, date: new Date().toISOString() };
        localStorage.setItem('noa_exam_adsterra_res', JSON.stringify(examData));
        showResults(score, userAns, false);
    }

    function showResults(finalScore, answers, isRevisit) {
        startScreen.classList.remove('active');
        gameScreen.classList.remove('active');
        resultScreen.classList.add('active');
        document.getElementById('timerBadge').style.display = 'none';
        document.getElementById('finishBtn').style.display = 'none';

        if(isRevisit) {
            document.getElementById('cheatAlert').style.display = 'block';
            document.getElementById('whatsappBtn').innerText = "REENVIAR RESULTADO";
        }

        document.getElementById('finalScore').innerText = `${finalScore}/100`;
        const rankEl = document.getElementById('rankBadge');
        if(finalScore >= 90) { rankEl.innerText = "EXPERTO"; rankEl.style.background = "#27ae60"; }
        else if(finalScore >= PASS_SCORE) { rankEl.innerText = "APROBADO"; rankEl.style.background = "#f39c12"; }
        else { rankEl.innerText = "REPROBADO"; rankEl.style.background = "#c0392b"; }
        document.getElementById('motivationalMsg').innerText = finalScore >= PASS_SCORE ? "¡Buen trabajo!" : "Inténtalo de nuevo.";

        const code = `NOA-${finalScore}-${Math.floor(Math.random()*9000)+1000}`;
        document.getElementById('valCode').innerText = code;

        const list = document.getElementById('reviewList');
        list.innerHTML = '';
        answers.forEach((a, i) => {
            const div = document.createElement('div');
            div.style.borderBottom = "1px solid #eee"; div.style.padding = "5px"; div.style.color = a.ok ? "green" : "red";
            div.innerHTML = `<strong>${i+1}.</strong> ${a.ok ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'} ${a.q}`;
            list.appendChild(div);
        });
    }

    function validateAndSend() {
        const name = document.getElementById('inputName').value.trim();
        const dni = document.getElementById('inputDNI').value.trim();
        const course = document.getElementById('inputCourse').value.trim();
        const code = document.getElementById('valCode').innerText;
        if(!name || !dni || !course) { alert("Completa los datos."); return false; }
        
        const msg = `*EXAMEN COLOR (ADS) - NOA*%0A--------------------------%0A*Alumno:* ${name}%0A*DNI:* ${dni}%0A*Curso:* ${course}%0A*Nota:* ${score}/100%0A*Código:* ${code}%0A--------------------------`;
        window.open(`https://wa.me/5493812234142?text=${msg}`, '_blank');
    }
    <script type='text/javascript' src='//pl28146673.effectivegatecpm.com/9a/ee/80/9aee80da4bcae63d9fdc6114ac650847.js'></script>
    <script type='text/javascript' src='//pl28146632.effectivegatecpm.com/d5/cf/80/d5cf80419b2247d347a2d1cc39aa75a3.js'></script>
</script>
</body>
</html>

